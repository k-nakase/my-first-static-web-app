<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="Category.css">
    <title>Cloud Service Overview</title>
  </head>
  <body>
    <div>
        <div>
          <h1 id="title" class="text-center">Cloud Service Category</h1>
        </div>
        <div class="scroll">
        <table id="main" style="font-size: 0.7rem">
            <thead>
              <tr id="theader">
                <th class="constant_header col1" style="background-color: white"></th>
                <th id="service_item0" class="constant_header col2">Service Item</th>
              </tr>
            </thead>
            <tbody>
              <tr id="service1">
                <td rowspan="6" class="title col_sticky">Cloud Service Management</td>
                <td id="service_item1" class="service col_sticky_sub">Asset Management</td>
              </tr>
              <tr id="service2">
                <td id="service_item2" class="service col_sticky_sub">Change Management</td>
              </tr>
              <tr id="service3">
                <td id="service_item3" class="service col_sticky_sub">Incident Management</td>
              </tr>
              <tr id="service4">
                <td id="service_item4" class="service col_sticky_sub">Problem Management</td>
              </tr>
              <tr id="service5">
                <td id="service_item5" class="service col_sticky_sub">Service Reporting</td>
              </tr>
              <tr id="service6">
                <td id="service_item6" class="service col_sticky_sub">Service Request Management</td>
              </tr>
              <tr id="service7">
                <td rowspan="3" class="title col_sticky">Available Levels of Service</td>
                <td id="service_item7" class="service col_sticky_sub">Enterprise</td>
              </tr>
              <tr id="service8">
                <td id="service_item8" class="service col_sticky_sub">Standard</td>
              </tr>
              <tr id="service9">
                <td id="service_item9" class="service col_sticky_sub">Foundation</td>
              </tr>
              <tr id="service10">
                <td rowspan="1" class="title col_sticky">Availability Management</td>
                <td id="service_item10" class="service col_sticky_sub">-</td>
              </tr>
              <tr id="service11">
                <td rowspan="1" class="title col_sticky">Backup</td>
                <td id="service_item11" class="service col_sticky_sub">-</td>
              </tr>
              <tr id="service12">
                <td rowspan="1" class="title col_sticky">Disaster Recovery</td>
                <td id="service_item12" class="service col_sticky_sub">-</td>
              </tr>
              <tr id="service13">
                <td rowspan="1" class="title col_sticky">*Blueprint Template Management</td>
                <td id="service_item13" class="service col_sticky_sub">-</td>
              </tr>
              <tr id="service14">
                <td rowspan="2" class="title col_sticky">Self Service Provisioning</td>
                <td id="service_item14" class="service col_sticky_sub">Via Service Catalogue</td>
              </tr>
              <tr id="service15">
                <td id="service_item15" class="service col_sticky_sub">Via Cloud API</td>
              </tr>
              <tr id="service16">
                <td rowspan="1" class="title col_sticky">Cloud Optimize</td>
                <td id="service_item16" class="service col_sticky_sub">-</td>
              </tr>
              <tr id="service17">
                <td rowspan="3" class="title col_sticky">Event Management & Monitoring</td>
                <td id="service_item17" class="service col_sticky_sub">Resource Insights (if applicable)</td>
              </tr>
              <tr id="service18">
                <td id="service_item18" class="service col_sticky_sub">Resource Health</td>
              </tr>
              <tr id="service19">
                <td id="service_item19" class="service col_sticky_sub">Service Health</td>
              </tr>
              <tr id="service20">
                <td rowspan="6" class="title col_sticky">Governance Policies & Guardrails</td>
                <td id="service_item20" class="service col_sticky_sub">???</td>
              </tr>
              <tr id="service21">
                <td id="service_item21" class="service col_sticky_sub">???</td>
              </tr>
              <tr id="service22">
                <td id="service_item22" class="service col_sticky_sub">???</td>
              </tr>
              <tr id="service23">
                <td id="service_item23" class="service col_sticky_sub">???</td>
              </tr>
              <tr id="service24">
                <td id="service_item24" class="service col_sticky_sub">???</td>
              </tr>
              <tr id="service25">
                <td id="service_item25" class="service col_sticky_sub">???</td>
              </tr>
              <tr id="service26">
                <td rowspan="4" class="title col_sticky">Logging</td>
                <td id="service_item26" class="service col_sticky_sub">Activity Logs</td>
              </tr>
              <tr id="service27">
                <td id="service_item27" class="service col_sticky_sub">Resource Logs</td>
              </tr>
              <tr id="service28">
                <td id="service_item28" class="service col_sticky_sub">Network flow logs (if applicable)</td>
              </tr>
              <tr id="service29">
                <td id="service_item29" class="service col_sticky_sub">Application logs (if applicable)</td>
              </tr>
              <tr id="service30">
                <td rowspan="1" class="title col_sticky">Patch Management</td>
                <td id="service_item30" class="service col_sticky_sub">-</td>
              </tr>
              <tr id="service31">
                <td rowspan="3" class="title col_sticky">Access & Security</td>
                <td id="service_item31" class="service col_sticky_sub">Identity and Access</td>
              </tr>
              <tr id="service32">
                <td id="service_item32" class="service col_sticky_sub">Security Logging</td>
              </tr>
              <tr id="service33">
                <td id="service_item33" class="service col_sticky_sub">Security Management Services</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <script>
        //URLからパラメータを取得
        const url = new URL(window.location.href);
        const params = url.searchParams;
        const id = params.get("id");
        const service = params.get("service");

        //jsonデータ取得設定
        let request = new XMLHttpRequest();
        request.open("GET", "sample.json");
        request.responseType = "json";
        request.send();

        //起動時実行
        request.onload = function() {
          //jsonデータ取得
          const cloud_data_obj = request.response;
          const cloud_data_json = JSON.parse(JSON.stringify(cloud_data_obj));
          //サービスカテゴリ取得
          for (let i=0; i<cloud_data_json.length; i++) {
            if (id==cloud_data_json[i]["id"]) {
              name = cloud_data_json[i]["name"];
              cloud_service_json = cloud_data_json[i]["service"];
              break;
            }
          }
          //タイトル直下にサービスカテゴリ名を追加
          title.insertAdjacentHTML("afterend", "<h2 class='subtitle'>"+name+"</h2>");

          //選択したカテゴリに含まれるサービスの種類数ループ
          for (let j=0; j<cloud_service_json.length; j++) {
            //対応表の画面設定
            let tag_position = "beforeend";
            let theader = document.getElementById("theader");
            //選択したサービスの先頭表示設定
            if (service!=null) {
              if (cloud_service_json[j]["service_name"]==service) {
                tag_position = "afterend";
                theader = document.getElementById("service_item0");
              }
            }
            //ヘッダ行作成
            theader.insertAdjacentHTML(tag_position, "<th class="+cloud_service_json[j]["class"]+">"+cloud_service_json[j]["service_name"]+"</th>");

            //row番目のタグにセルを追加
            let row = 1;
            //サービス毎にセル作成
            for (let k=0; k<cloud_service_json[j]["category"].length; k++) {
              //サービスカテゴリ選択時
              let tag_position = "beforeend";
              let gray_out = "";
              //サービス選択時
              if (service!=null) {
                //対応表の強調表示設定
                if (cloud_service_json[j]["service_name"]==service) {
                  tag_position = "afterend";
                  gray_out = "";
                }else {
                  gray_out = "style='opacity: 0.5'";
                }
              }
              //各項目のデータ取得
              for (let l=0; l<cloud_service_json[j]["category"][k]["Service Item"].length; l++) {
                let icon = cloud_service_json[j]["category"][k]["Service Item"][l]["icon"];
                let comment = cloud_service_json[j]["category"][k]["Service Item"][l]["comment"];

                //選択したサービスの先頭表示設定
                let tag_id = document.getElementById("service"+String(row));
                if (cloud_service_json[j]["service_name"]==service) { 
                  tag_id = document.getElementById("service_item"+String(row));
                }
                //マークの有無確認
                if (icon=="") {
                  //マークなしセルを追加
                  tag_id.insertAdjacentHTML(tag_position, "<td class='service' "+gray_out+">"+comment+"</td>");
                }else {
                  //マークありセルを追加
                  tag_id.insertAdjacentHTML(tag_position, "<td class='service' "+gray_out+"><img src=category/"+icon+"></img>"+comment+"</td>");
                }
                row = row+1;
              }
            }
          }
        }
      </script>
  </body>
</html>
